<% include ./partials/header %>

<nav class="navbar navbar-expand-lg fixed-top">
  <div class="container">
	  <div>
		  <ul class="navbar-nav mr-auto">
			  <li class="nav-item">
				  <a href="https://github.com/JapmanN" class="text-white" target="_blank"><i class="fab fa-github nav-icons mr-3"></i></a>
				  <a href="https://www.linkedin.com/in/japman-nagra-464b7116a/" class="text-white" target="_blank"><i class="fab fa-linkedin nav-icons"></i></a>
			  </li>
		  </ul>
	  </div>
	  
	  <span class="navbar-brand mx-auto text-light nav-text">
		  Logged in as <a href="#" class="text-white font-weight-bold"><%= user.body.display_name %></a>
	  </span>
	  
	  <div>
		  <ul class="navbar-nav ml-auto">
			  <li class="nav-item">
				  <a class="nav-link text-white" href="https://accounts.spotify.com/en/status" id="logout">Logout</a>
			  </li>
		  </ul>
	  </div>
	</div>
</nav>

<div class="container mt-5">
	<div class="jumbotron text-center rounded-lg">
		<div id="showScoreHtml" class="d-none">
			<h1 class="option" id="H1Score">Your Score is <span id="scoreWhileUserIsPlaying" class="text-success"><%= %></span></h1>
			<button onclick="location.reload();" id="playAgain" class="btn btn-dark btn-lg rounded-lg d-none mt-2"><i class="fa fa-redo-alt mr-2"></i>   Try Again</button>
		</div>
		<div id="welcome" class="d-none">
			<h1 class="text-center">Welcome to the</h1>
			<h1 class="display-4">
				<i class="fas fa-music text-secondary mr-3"></i>
				<span id="title">Spotify-Popularity-Game</span>
				<i class="fas fa-music text-secondary ml-3"></i>
			</h1>
			<a class="btn btn-dark mt-2 btn-lg rounded-lg" href="/more-info" role="button">More Information</a>
		</div>
	</div>
</div>	

<div class="container" id="theBody">
	<div class="row">
		<div class="col-lg-6 text-center">
			<center>
				<% for (var i = Math.floor(Math.random() * 50), j = 0; j < 1; j++) { %>
				<div class="card bg-none border-0" style="width: 30rem;">	
					<img src="<%= savedTracks.body.items[i].track.album.images[0].url %>" class="card-img-top">
					<div class="card-body">
						<h1 class="card-title option choice_one"><%= savedTracks.body.items[i].track.name %></h1>
						<button class="btn btn-outline-success btn-block rounded-pill choice_one_btn"><i class="fas fa-caret-up fa-3x"></i></button>
					</div>
				</div>
				<% } %>
			</center>
		</div>
		
		<div class="col-lg-6">
			<center>
				<% for (var k = Math.floor(Math.random() * 50), m = 0; m < 1; m++) { %>
				<div class="card bg-none border-0" style="width: 30rem;">
					<img src="<%= savedTracks.body.items[k].track.album.images[0].url %>" class="card-img-top">
					<div class="card-body">
						<h1 class="card-title option choice_two"><%= savedTracks.body.items[k].track.name %></h1>
						<button class="btn btn-outline-success btn-block rounded-pill choice_two_btn"><i class="fas fa-caret-up fa-3x"></i></button>
					</div>
				</div>
				<% } %>
			</center>
		</div>
	</div>
</div>

<script>
	var score = localStorage.getItem("theScore");
	
	if (score == null || score == 0) {
		score = 0;
		localStorage.setItem("theScore", score);
		$("div#welcome").removeClass("d-none");
	} else {
		$("div#showScoreHtml").removeClass("d-none");
		$("span#scoreWhileUserIsPlaying").html(score);
	}
	
	$("button.choice_two_btn").on("click", function() {
		var first_song = <%= savedTracks.body.items[i].track.popularity %>;
		var second_song = <%= savedTracks.body.items[k].track.popularity %>;
		if(second_song > first_song) {
			ifUserGuessesRight();
		} else if(second_song == first_song) {
			ifSamePopularity();
		} else {
			ifUserGuessesWrong();
		}
	});

	$("button.choice_one_btn").on("click", function() {
		var first_song = <%= savedTracks.body.items[i].track.popularity %>;
		var second_song = <%= savedTracks.body.items[k].track.popularity %>;
		if(first_song > second_song) {
			ifUserGuessesRight();
		} else if(second_song == first_song) {
			ifSamePopularity();
		} else {
			ifUserGuessesWrong();
		}
	});
	
	function ifUserGuessesRight() {
		// Update Score
		score++;
		localStorage.setItem("theScore", score);
		
		// Show CORRECT modal
		$('#correctModal').modal('show');

		// Hide the CORRECT modal after 1 second
		setTimeout(function() {
			$('#correctModal').modal('hide');
		}, 1000);
		
		// Start refreshing the page after 800 milliseconds
		setTimeout(function() {
			location.reload();
		}, 800);
	}
	
	function ifSamePopularity() {
		// Update Score
		score++;
		localStorage.setItem("theScore", score);
		
		// Show EQUAL modal
		$('#equalModal').modal('show');

		// Hide the EQUAL modal after 1 second
		setTimeout(function() {
			$('#equalModal').modal('hide');
		}, 1500);
		
		// Start refreshing the page after 800 milliseconds
		setTimeout(function() {
			location.reload();
		}, 1250);
	}
	
	function ifUserGuessesWrong() {
		// Show the button to play again and show the FINAL SCORE
		$("button#playAgain").removeClass("d-none");
		$("h1#H1Score").html("Your Final Score is <span id='scoreWhileUserIsPlaying' class='text-success'>" +  score + "</span");
		
		// Set the SCORE back to 0 and store it
		score = 0;
		localStorage.setItem("theScore", score);
		
		// Show WRONG modal
		$('#wrongModal').modal('show');
		
		setTimeout(function() {
			$('#wrongModal').modal('hide');
			$("#theBody").addClass("d-none");
		}, 1000);
	}
</script>


<!-- Modal if user guesses CORRECT -->
<div class="modal fade" id="correctModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content" style="background: none;">
      <div class="modal-body text-center">
        <i class="bg-success rounded-circle p-5 fas fa-check fa-10x"></i>
      </div>
    </div>
  </div>
</div>


<!-- Modal if popularity is EQUAL -->
<div class="modal fade" id="equalModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content" style="background: none;">
      <div class="modal-body text-center">
        <i class="bg-warning rounded-circle p-5 fas fa-equals fa-10x" style="padding: 3rem 60px !important;"></i>
		  <h1 class="font-weight-bold">Same Popularity. <span class="text-success">Free Point!</span></h1>
      </div>
    </div>
  </div>
</div>

<!-- Modal if user guesses WRONG -->
<div class="modal fade" id="wrongModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content" style="background: none;">
      <div class="modal-body text-center">
        <i class="bg-danger rounded-circle p-5 fas fa-times fa-10x" style="padding: 3rem 75px !important;"></i>
      </div>
    </div>
  </div>
</div>

<% include ./partials/footer %>

<!-- savedTracks.body.items[i].track.name -->
<!-- savedTracks.body.items.length  -->
<!-- songs.songs_arr[Math.floor(Math.random() * 51)] -->